<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-spinner/paper-spinner.html">

<link rel="import" href="shared-styles.html">

<dom-module id="data-table">
    <template>
        <style include="shared-style">
            :host {
                display: block
            }
            @import url(https://fonts.googleapis.com/css?family=Roboto:400,500,700,300,100);
            #spinner
            {
                margin-left: 50%;
                margin-right: 50%;
                display: none;
            }
            body {
                background-color: #3e94ec;
                font-family: "Roboto", helvetica, arial, sans-serif;
                font-size: 16px;
                font-weight: 400;
                text-rendering: optimizeLegibility;
            }
            
            div.table-title {
                display: block;
                margin: auto;
                max-width: 600px;
                padding:5px;
                width: 100%;
            }
            
            .table-title h3 {
                color: #fafafa;
                font-size: 30px;
                font-weight: 400;
                font-style:normal;
                font-family: "Roboto", helvetica, arial, sans-serif;
                text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.1);
                text-transform:uppercase;
            }
            
            
            /*** Table Styles **/
            
            .table-fill {
                background: white;
                border-radius:3px;
                border-collapse: collapse;
                height: 320px;
                margin: auto;
                max-width: 600px;
                padding:5px;
                width: 100%;
                box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
                animation: float 5s infinite;
            }
            
            th {
                color:#D5DDE5;;
                background:#1b1e24;
                border-bottom:4px solid #9ea7af;
                border-right: 1px solid #343a45;
                font-size:23px;
                font-weight: 100;
                padding:24px;
                text-align:left;
                text-shadow: 0 1px 1px rgba(0, 0, 0, 0.1);
                vertical-align:middle;
            }
            
            th:first-child {
                border-top-left-radius:3px;
            }
            
            th:last-child {
                border-top-right-radius:3px;
                border-right:none;
            }
            
            tr {
                border-top: 1px solid #C1C3D1;
                border-bottom: 1px solid #C1C3D1;
                color:#666B85;
                font-size:16px;
                font-weight:normal;
                text-shadow: 0 1px 1px rgba(256, 256, 256, 0.1);
            }
            
            tr:hover td {
                background:#4E5066;
                color:#FFFFFF;
                border-top: 1px solid #22262e;
            }
            
            tr:first-child {
                border-top:none;
            }
            
            tr:last-child {
                border-bottom:none;
            }
            
            tr:nth-child(odd) td {
                background:#EBEBEB;
            }
            
            tr:nth-child(odd):hover td {
                background:#4E5066;
            }
            
            tr:last-child td:first-child {
                border-bottom-left-radius:3px;
            }
            
            tr:last-child td:last-child {
                border-bottom-right-radius:3px;
            }
            
            td {
                background:#FFFFFF;
                padding:20px;
                text-align:left;
                vertical-align:middle;
                font-weight:300;
                font-size:18px;
                text-shadow: -1px -1px 1px rgba(0, 0, 0, 0.1);
                border-right: 1px solid #C1C3D1;
            }
            
            td:last-child {
                border-right: 0px;
            }
            
            th.text-left {
                text-align: left;
            }
            
            th.text-center {
                text-align: center;
            }
            
            th.text-right {
                text-align: right;
            }
            
            td.text-left {
                text-align: left;
            }
            
            td.text-center {
                text-align: center;
            }
            
            td.text-right {
                text-align: right;
            }
            
        </style>
        
        
        <!--<paper-button raised on-tap="_testButton" class="primary">test button</paper-button>-->
        <table class="table-fill">
            <thead>
                <tr>
                    <template is="dom-repeat" items="{{tableHead}}" as="thead">
                        <th class="text-left">{{thead}}</th>
                    </template>
                </tr>
            </thead>
            <tbody class="table-hover">
                <template is="dom-repeat" items="{{tableData}}" as="row">
                    <tr>
                        <template is="dom-repeat" items="{{row}}" as="cell">
                            <td>{{cell}}</td>
                        </template>
                    </tr>
                </template>
            </tbody>
        </table>
        <paper-spinner id="spinner" active></paper-spinner>
        <iron-ajax id="tableAjax" on-response='handleResponse'></iron-ajax>
    </template>
    <script>
        
        class DataTable extends Polymer.Element {
            
            static get is() {
                return 'data-table';
            }
            static get properties() {
                return {
                    tableData: {
                        type: Object,
                        value: null
                    },
                    queryUrl:{
                        type: String,
                        observer: '_queryUrlChanged'
                    },
                    reload: {
                        type: Boolean,
                        value : false,
                        observer: '_reloadChanged'
                    }
                }
            }
            static get observers() {
            }
            
            ready() {
                super.ready();
                this.$.spinner.style.display = 'none';
            }
            _getData(url) {
                this.$.tableAjax.url = url;
                this.$.tableAjax.method = 'GET';
                this.$.tableAjax.generateRequest();
            }
            handleResponse(evt)
            {
                //console.log('raw data : ', evt.detail.response);
                this.$.spinner.style.display = 'none';
                this.tableData = this._buildTable(evt.detail.response);
            }
            _queryUrlChanged(val)
            {
                this._getData(val);
                //console.log(val);
                this.$.spinner.style.display = 'block';
            }
            _reloadChanged(val){
                //console.log(val);
            }
            _buildTable(rawData){

                //console.log('rawData : ', rawData);
                var table = new Array();
                
                this.tableHead = Object.keys(rawData[0]);
                
                rawData.forEach(function(rawLine){
                    table.push(Object.values(rawLine));
                });
                //console.log('ridofkey table : ', table);
                return table;
            }
        }
        window.customElements.define(DataTable.is, DataTable);
    </script>
</dom-module>