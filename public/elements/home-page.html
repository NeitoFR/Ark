<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="shared-styles.html">

<dom-module id="home-page">
  <template>
    <style include="shared-styles">
      .content {
        padding: 15px;
      }
    </style>

    <brum-global-variable key="userData" value="{{storedUser}}"></brum-global-variable>
    <div class="flex flex--col content" style="margin:auto">
      <!-- <paper-button raised on-tap="_testButton" class="primary">Test</paper-button> -->
      <div class="flex__item--middle">
        <h1>Bienvenue sur le site de l'Arche</h1>
      </div>
      <div class="flex__item--middle">
        <h1>Veuillez vous connecter et naviguer via le menu qui apparaitra en haut Ã  gauche</h1>
      </div>
      <div class="flex__item--middle">
        <h1>Site en construction</h1>
      </div>
      <div class="flex__item--middle"><h1><img src="../images/ark-logo.png" alt="Working"></h1></div>
      <a href="" id="pdflink"></a>
      <div class="flex__item" id='pdf'></div>
    </div>

    <iron-ajax id='ajaxEl' content-type='application/json' on-response='handleResponse'></iron-ajax>
  </template>

  <script>
    class HomePage extends Polymer.Element {
      static get is() {
        return 'home-page';
      }
      static get properties() {
        return
      }
      ready() {
        super.ready();
      }
      _testButton() {
        // console.log('stored user : ',this.storedUser);
        this._getPDF(12);
      }
      _getPDF(projectId) {
        this.$.ajaxEl.url = '/getPDF/' + projectId;
        this.$.ajaxEl.method = 'GET'
        this.$.ajaxEl.generateRequest();
      }
      handleResponse(evt) {
        if (evt.detail.url.includes('/getPDF/')) {
          this.save("cahier_de_bord.pdf", evt.detail.response[0].file);
          console.log( evt.detail.response[0].file);
        }
      }
      save(filename, data) {
        var blob = new Blob([data], {
          encoding:"UTF-8",
          type: 'application/pdf;charset=UTF-8'
        });
        if (window.navigator.msSaveOrOpenBlob) {
          window.navigator.msSaveBlob(blob, filename);
        } else {
          var elem = window.document.createElement('a');
          elem.href = window.URL.createObjectURL(blob);
          elem.download = filename;
          document.body.appendChild(elem);
          elem.click();
          document.body.removeChild(elem);
        }
      }
      _testButton2() {
        var date = new Date();
        // console.log(date.getDate()+'/'+date.getMonth()+'/'+date.getFullYear()+' '+date.getUTCHours() + ':' + date.getUTCMinutes()+'');     
      }
    }
    window.customElements.define(HomePage.is, HomePage);
  </script>
</dom-module>